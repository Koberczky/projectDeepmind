<!DOCTYPE html>
<html>
    <head>
	<meta charset="utf-8" />
	<meta name="format-detection" content="telephone=no" />
	<link rel="stylesheet" src="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/style.css" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
	<!-- <link href='http://fonts.googleapis.com/css?family=Convergence|Bitter|Droid+Sans|Ubuntu+Mono' rel='stylesheet' type='text/css' /> -->
	<script type="text/javascript" src="js/gmaps.js"></script>
	<script type="text/javascript" src="js/makeRequest.js"></script>
	<script type="text/javascript" src="js/jQuery.js"></script>
	<link rel="stylesheet" type="text/css" href="css/index.css" />
	</head>
	<body>
		<a class="ui-btn-top" data-icon="arrow-l" href="javascript:history.back(1) " data-theme="a">Back</a>
		<div id="map-canvas"></div>
		<script type="text/javascript">
		jQuery(document).ready(function($){
			makeRequest(drawBuildings);
			var map;
			map = new GMaps({
				el: '#map-canvas',
				lat: 38.8940799,
				lng: -89.4092642,
				zoom: 17,
				MapTypeId: google.maps.MapTypeId.HYBRID,
				zoomControl : true,
				zoomControlOpt: {
					style : 'SMALL',
					position: 'TOP_LEFT'
				},
				panControl : false,
				streetViewControl : false,
				mapTypeControl: true,
				overviewMapControl: true
				});
				getcurrentlatlong();
				function getcurrentlatlong(){
					if (navigator.geolocation){              
						navigator.geolocation.getCurrentPosition(onSuccess, onError, { enableHighAccuracy:true });
					}else{
					}
				}
				var marker;
				function onSuccess(position) {
					var lat=position.coords.latitude;
					var lng=position.coords.longitude;
					var latlng=new google.maps.LatLng(lat, lng);
					marker = map.addMarker({
						position: latlng,
						title:"Current Location!",
						visible: true
                    })
					
				}
				
				function onError(error) {
					alert('code: ' + error.code + '\n' + 'message: ' + error.message + '\n');
				}
				function drawBuildings(data){
					data.contentlets.forEach(function(building){
						if (building.title == "The Gullies" || building.title == "Scott Field"){
						}else{
							var x = building.latlongcsv;
							var patharray = x.split(';');
							patharray.splice(-1,1);
							i=0;
							while (patharray.length > i){
								patharray[i] = patharray[i].split(',');
								i++;
							}
							polygon = map.drawPolygon({
								paths: patharray,
								strokeOpacity: 1,
								strokeColor: '#4494c3',
								strokeWeight: 3,
								fillColor: '#BBD8E9',
								fillOpacity: 0.6,
								zIndex: 999
							});
						}
					});
				}
				var watchID = navigator.geolocation.watchPosition(getcurrentlatlong, onError, { timeout: 30000 });
			});
		</script>
		    <script src="js/foundation.min.js"></script>
	</body>
</html>
